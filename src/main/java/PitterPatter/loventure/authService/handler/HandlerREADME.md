# AuthService: 인증 결과 핸들러 (Handler) ⚙️

이 문서는 `authService` 내 `handler` 패키지의 역할과 동작 방식을 설명합니다. 이 패키지에 포함된 클래스들은 **OAuth2 소셜 로그인 과정의 최종 단계인 성공과 실패를 전문적으로 처리**하는 '마무리 담당자' 역할을 수행합니다.

`SecurityConfig`에 설정된 바에 따라, 로그인 과정의 결과에 맞춰 적절한 핸들러가 자동으로 호출됩니다.

---

## 🚀 핸들러의 핵심 역할

핸들러의 주된 임무는 백엔드에서의 인증 처리 결과를 프론트엔드(클라이언트)가 명확하게 인지하고 후속 조치를 할 수 있도록 **안전하게 연결하는 다리 역할**을 하는 것입니다.

* **로그인 성공 시**: JWT 토큰을 비롯한 최종 인증 정보를 생성하고, 이를 클라이언트에게 전달합니다.
* **로그인 실패 시**: 실패 원인을 사용자 친화적인 메시지로 변환하여, 클라이언트에게 실패 사실을 명확히 알립니다.

---

## 🛠️ 주요 컴포넌트 설명

### `OAuth2LoginSuccessHandler.java`

**'성공 처리 전문가'** 로, 소셜 로그인이 성공적으로 완료된 직후에 호출됩니다.

#### 주요 동작 흐름

1.  **인증 정보 확인**: Spring Security로부터 인증이 완료된 사용자 정보(`OAuth2User`)를 전달받습니다.
2.  **핵심 로직 위임**: `AuthService`의 `processOAuth2Login` 메서드를 호출하여 실제 비즈니스 로직(DB 저장/업데이트, JWT 생성 등)을 수행하도록 합니다. 이 과정에서 **Access Token**과 **Refresh Token**이 최종적으로 생성됩니다.
3.  **리다이렉트 URL 생성**: `AuthService`로부터 받은 결과(`AuthResponse`)를 바탕으로 프론트엔드로 전달할 최종 리다이렉트 URL을 구성합니다. 이 URL의 **쿼리 파라미터**에는 아래와 같은 핵심 정보가 포함됩니다.
    * `access_token`: API 요청 시 사용할 액세스 토큰
    * `refresh_token`: 액세스 토큰 갱신에 사용할 리프레시 토큰
    * `is_new_user`: 신규 회원가입 여부 (프론트에서 추가 정보 입력 등의 분기 처리에 사용)
    * 사용자 정보 (ID, 이메일 등)
4.  **클라이언트 리다이렉트**: 사용자의 브라우저를 생성된 URL로 이동시킵니다. 이후 프론트엔드 애플리케이션이 URL에서 토큰 정보를 추출하여 저장하고, 로그인 후의 페이지를 렌더링하게 됩니다.

### `OAuth2LoginFailureHandler.java`

**'실패 처리 담당자'** 로, 소셜 로그인 과정 중 어떤 이유로든 예외가 발생했을 때 호출됩니다.

#### 주요 동작 흐름

1.  **실패 원인 로깅**: 가장 먼저 서버 로그에 실패 원인(`AuthenticationException`)을 상세히 기록하여 추후 디버깅에 활용합니다.
2.  **에러 메시지 변환**: 기술적이고 복잡한 예외 메시지를 `access_denied`(사용자 동의 거부)와 같이 **사용자가 이해하기 쉬운 단순한 메시지로 변환**합니다.
3.  **실패 페이지 URL 생성**: 프론트엔드의 실패 처리 페이지(`/login-failure`) URL에 변환된 에러 메시지를 쿼리 파라미터로 추가합니다.
4.  **클라이언트 리다이렉트**: 사용자의 브라우저를 실패 페이지로 이동시켜, 왜 로그인이 실패했는지 명확하게 인지할 수 있도록 돕습니다. 이는 좋은 사용자 경험(UX)을 위해 매우 중요합니다.